{"ast":null,"code":"import { collection, addDoc, updateDoc, deleteDoc, doc, getDoc, getDocs, query, where, orderBy, serverTimestamp, limit } from 'firebase/firestore';\nimport { db } from './firebase';\n\n// Places\nexport const clearAllPlaces = async () => {\n  try {\n    const placesRef = collection(db, 'places');\n    const snapshot = await getDocs(placesRef);\n    const batchDeletes = [];\n    snapshot.forEach(docSnap => {\n      batchDeletes.push(deleteDoc(doc(db, 'places', docSnap.id)));\n    });\n    await Promise.all(batchDeletes);\n    return true;\n  } catch (error) {\n    console.error('Error clearing all places:', error);\n    throw error;\n  }\n};\nexport const addPlace = async placeData => {\n  try {\n    // Remove undefined/null fields from placeData\n    const sanitizedData = Object.fromEntries(Object.entries(placeData).filter(([_, v]) => v !== undefined && v !== null));\n    const placesRef = collection(db, 'places');\n    const newPlace = {\n      ...sanitizedData,\n      createdAt: serverTimestamp(),\n      updatedAt: serverTimestamp()\n    };\n    // Extra debug logging\n    console.log('Attempting to add place:', newPlace);\n    const result = await addDoc(placesRef, newPlace);\n    console.log('Place added successfully:', result.id);\n    return result;\n  } catch (error) {\n    // Enhanced error logging\n    if (error && error.code && error.message) {\n      console.error(`Firestore error [${error.code}]: ${error.message}`);\n    } else {\n      console.error('Unknown error adding place:', error);\n    }\n    throw error;\n  }\n};\nexport const getPlaces = async () => {\n  try {\n    const placesRef = collection(db, 'places');\n    const q = query(placesRef, orderBy('name', 'asc'));\n    const querySnapshot = await getDocs(q);\n    return querySnapshot.docs.map(doc => ({\n      id: doc.id,\n      ...doc.data()\n    }));\n  } catch (error) {\n    console.error('Error getting places:', error);\n    throw error;\n  }\n};\nexport const getPlacesByCategory = async category => {\n  try {\n    const placesRef = collection(db, 'places');\n    const q = query(placesRef, where('category', '==', category), orderBy('name', 'asc'));\n    const querySnapshot = await getDocs(q);\n    return querySnapshot.docs.map(doc => ({\n      id: doc.id,\n      ...doc.data()\n    }));\n  } catch (error) {\n    console.error('Error getting places by category:', error);\n    throw error;\n  }\n};\n\n// Reports\nexport const addReport = async reportData => {\n  try {\n    const reportsRef = collection(db, 'reports');\n    const newReport = {\n      ...reportData,\n      timestamp: serverTimestamp(),\n      expiresAt: new Date(Date.now() + 2 * 60 * 60 * 1000) // 2 hours from now\n    };\n    return await addDoc(reportsRef, newReport);\n  } catch (error) {\n    console.error('Error adding report:', error);\n    throw error;\n  }\n};\nexport const getRecentReportsByPlace = async placeId => {\n  try {\n    const reportsRef = collection(db, 'reports');\n    const now = new Date();\n    const q = query(reportsRef, where('placeId', '==', placeId), where('expiresAt', '>', now), orderBy('expiresAt', 'desc'), orderBy('timestamp', 'desc'), limit(10));\n    const querySnapshot = await getDocs(q);\n    return querySnapshot.docs.map(doc => ({\n      id: doc.id,\n      ...doc.data()\n    }));\n  } catch (error) {\n    console.error('Error getting recent reports:', error);\n    throw error;\n  }\n};\nexport const getUserReports = async userId => {\n  try {\n    const reportsRef = collection(db, 'reports');\n    const q = query(reportsRef, where('userId', '==', userId), orderBy('timestamp', 'desc'));\n    const querySnapshot = await getDocs(q);\n    return querySnapshot.docs.map(doc => ({\n      id: doc.id,\n      ...doc.data()\n    }));\n  } catch (error) {\n    console.error('Error getting user reports:', error);\n    throw error;\n  }\n};\nexport const deleteReport = async reportId => {\n  try {\n    const reportRef = doc(db, 'reports', reportId);\n    await deleteDoc(reportRef);\n  } catch (error) {\n    console.error('Error deleting report:', error);\n    throw error;\n  }\n};","map":{"version":3,"names":["collection","addDoc","updateDoc","deleteDoc","doc","getDoc","getDocs","query","where","orderBy","serverTimestamp","limit","db","clearAllPlaces","placesRef","snapshot","batchDeletes","forEach","docSnap","push","id","Promise","all","error","console","addPlace","placeData","sanitizedData","Object","fromEntries","entries","filter","_","v","undefined","newPlace","createdAt","updatedAt","log","result","code","message","getPlaces","q","querySnapshot","docs","map","data","getPlacesByCategory","category","addReport","reportData","reportsRef","newReport","timestamp","expiresAt","Date","now","getRecentReportsByPlace","placeId","getUserReports","userId","deleteReport","reportId","reportRef"],"sources":["C:/Users/Vihaan/Desktop/When To Visit/src/services/firestoreService.js"],"sourcesContent":["import { \n  collection, \n  addDoc, \n  updateDoc, \n  deleteDoc, \n  doc, \n  getDoc, \n  getDocs, \n  query, \n  where, \n  orderBy, \n  serverTimestamp,\n  limit\n} from 'firebase/firestore';\nimport { db } from './firebase';\n\n// Places\nexport const clearAllPlaces = async () => {\n  try {\n    const placesRef = collection(db, 'places');\n    const snapshot = await getDocs(placesRef);\n    const batchDeletes = [];\n    snapshot.forEach(docSnap => {\n      batchDeletes.push(deleteDoc(doc(db, 'places', docSnap.id)));\n    });\n    await Promise.all(batchDeletes);\n    return true;\n  } catch (error) {\n    console.error('Error clearing all places:', error);\n    throw error;\n  }\n};\n\nexport const addPlace = async (placeData) => {\n  try {\n    // Remove undefined/null fields from placeData\n    const sanitizedData = Object.fromEntries(\n      Object.entries(placeData).filter(([_, v]) => v !== undefined && v !== null)\n    );\n\n    const placesRef = collection(db, 'places');\n    const newPlace = {\n      ...sanitizedData,\n      createdAt: serverTimestamp(),\n      updatedAt: serverTimestamp()\n    };\n    // Extra debug logging\n    console.log('Attempting to add place:', newPlace);\n    const result = await addDoc(placesRef, newPlace);\n    console.log('Place added successfully:', result.id);\n    return result;\n  } catch (error) {\n    // Enhanced error logging\n    if (error && error.code && error.message) {\n      console.error(`Firestore error [${error.code}]: ${error.message}`);\n    } else {\n      console.error('Unknown error adding place:', error);\n    }\n    throw error;\n  }\n};\n\nexport const getPlaces = async () => {\n  try {\n    const placesRef = collection(db, 'places');\n    const q = query(placesRef, orderBy('name', 'asc'));\n    const querySnapshot = await getDocs(q);\n    \n    return querySnapshot.docs.map(doc => ({\n      id: doc.id,\n      ...doc.data()\n    }));\n  } catch (error) {\n    console.error('Error getting places:', error);\n    throw error;\n  }\n};\n\nexport const getPlacesByCategory = async (category) => {\n  try {\n    const placesRef = collection(db, 'places');\n    const q = query(\n      placesRef, \n      where('category', '==', category),\n      orderBy('name', 'asc')\n    );\n    const querySnapshot = await getDocs(q);\n    \n    return querySnapshot.docs.map(doc => ({\n      id: doc.id,\n      ...doc.data()\n    }));\n  } catch (error) {\n    console.error('Error getting places by category:', error);\n    throw error;\n  }\n};\n\n// Reports\nexport const addReport = async (reportData) => {\n  try {\n    const reportsRef = collection(db, 'reports');\n    const newReport = {\n      ...reportData,\n      timestamp: serverTimestamp(),\n      expiresAt: new Date(Date.now() + 2 * 60 * 60 * 1000) // 2 hours from now\n    };\n    return await addDoc(reportsRef, newReport);\n  } catch (error) {\n    console.error('Error adding report:', error);\n    throw error;\n  }\n};\n\nexport const getRecentReportsByPlace = async (placeId) => {\n  try {\n    const reportsRef = collection(db, 'reports');\n    const now = new Date();\n    \n    const q = query(\n      reportsRef,\n      where('placeId', '==', placeId),\n      where('expiresAt', '>', now),\n      orderBy('expiresAt', 'desc'),\n      orderBy('timestamp', 'desc'),\n      limit(10)\n    );\n    \n    const querySnapshot = await getDocs(q);\n    \n    return querySnapshot.docs.map(doc => ({\n      id: doc.id,\n      ...doc.data()\n    }));\n  } catch (error) {\n    console.error('Error getting recent reports:', error);\n    throw error;\n  }\n};\n\nexport const getUserReports = async (userId) => {\n  try {\n    const reportsRef = collection(db, 'reports');\n    const q = query(\n      reportsRef,\n      where('userId', '==', userId),\n      orderBy('timestamp', 'desc')\n    );\n    \n    const querySnapshot = await getDocs(q);\n    \n    return querySnapshot.docs.map(doc => ({\n      id: doc.id,\n      ...doc.data()\n    }));\n  } catch (error) {\n    console.error('Error getting user reports:', error);\n    throw error;\n  }\n};\n\nexport const deleteReport = async (reportId) => {\n  try {\n    const reportRef = doc(db, 'reports', reportId);\n    await deleteDoc(reportRef);\n  } catch (error) {\n    console.error('Error deleting report:', error);\n    throw error;\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}